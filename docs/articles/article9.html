<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Article 9 – Guiding Questions</title>

  <!-- Tabulator CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tabulator-tables/6.3.0/css/tabulator.min.css">
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
    .topbar { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    input { padding:8px 10px; font-size:14px; min-width: 260px; }
    a { text-decoration:none; }
  </style>
</head>
<body>
  <div class="topbar">
    <h1 style="margin:0;">Article 9</h1>
    <a href="../index.html">← Back to index</a>
    <input id="search" type="search" placeholder="Search in table…" />
  </div>

  <div id="table" style="margin-top:16px;"></div>

 <script>
  const dataUrl = "../data/article-09.json";

  // Define the columns you want, in order (adjust fields to match your JSON keys exactly)
  const columns = [
    { title: "Requirement (AI Act)", field: "Requirement (AI Act)", widthGrow: 2, formatter: "textarea" },
    { title: "Compliance checklist", field: "Compliance checklist", widthGrow: 2, formatter: "textarea" },
    { title: "Guiding Questions", field: "Guiding Questions", widthGrow: 3, formatter: "textarea" },
    { title: "In-Context", field: "In-Context", widthGrow: 2, formatter: "textarea" },
  ];

  const table = new Tabulator("#table", {
    layout: "fitColumns",
    responsiveLayout: "collapse",
    pagination: true,
    paginationSize: 20,
    movableColumns: true,
    ajaxURL: dataUrl,

    // IMPORTANT: normalize whatever you loaded into "one object per row"
    ajaxResponse: function(url, response){
      // Case 1: already good (array of objects with the right keys)
      if (Array.isArray(response) && response.length && typeof response[0] === "object" && !("key" in response[0] && "value" in response[0])) {
        return response;
      }

      // Case 2: key/value format -> turn into a single row (or multiple rows if needed)
      // If your JSON is literally [{"key": "...", "value":"..."}...]
      if (Array.isArray(response) && response.length && "key" in response[0] && "value" in response[0]) {
        // This makes ONE row containing all keys as columns
        const row = {};
        for (const kv of response) row[kv.key] = kv.value;
        return [row];
      }

      // Case 3: nested object (e.g. {fields:{...}})
      if (Array.isArray(response) && response.length && response[0].fields) {
        return response.map(r => r.fields);
      }

      // Fallback: return as-is
      return response;
    },

    columns: columns,
  });

  // Search stays same as you already have
</script>
</body>
</html>
